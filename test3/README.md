# BeggingContract - 讨饭合约

## 项目简介

BeggingContract（讨饭合约）是一个基于以太坊的智能合约，允许用户向合约地址捐赠以太币，合约所有者可以提取所有捐赠的资金。这是一个学习Solidity开发的实践项目，展示了基本的支付、存储和权限控制功能。

## 合约功能

### 核心功能
1. **捐赠功能** - 用户可以向合约发送以太币进行捐赠
2. **资金提取** - 合约所有者可以提取所有捐赠资金
3. **捐赠查询** - 可以查询任意地址的捐赠金额
4. **捐赠者管理** - 记录和管理所有捐赠者信息

### 详细功能说明

#### 1. donate() - 捐赠函数
- **功能**：接收用户的以太币捐赠
- **修饰符**：`payable` - 允许接收以太币
- **要求**：捐赠金额必须大于0
- **记录**：自动记录捐赠者地址和金额
- **事件**：触发 `DonationReceived` 事件

#### 2. withdraw() - 提取函数
- **功能**：提取合约中的所有资金
- **权限**：仅合约所有者可调用（`onlyOwner`修饰符）
- **安全性**：使用 `call` 方法进行安全转账
- **事件**：触发 `FundsWithdrawn` 事件

#### 3. getDonation(address) - 查询捐赠
- **功能**：查询指定地址的总捐赠金额
- **参数**：捐赠者地址
- **返回**：该地址的累计捐赠金额

#### 4. 辅助查询函数
- `getContractBalance()` - 获取合约当前余额
- `getDonorCount()` - 获取捐赠者总数
- `getDonorByIndex(uint256)` - 根据索引获取捐赠者地址
- `getAllDonors()` - 获取所有捐赠者地址列表

#### 5. 安全功能
- `emergencyWithdraw()` - 紧急提取功能
- `transferOwnership(address)` - 转移合约所有权
- `receive()` 和 `fallback()` - 接收直接转账

## 合约特性

### 安全特性
- **权限控制**：使用 `onlyOwner` 修饰符保护敏感操作
- **输入验证**：检查捐赠金额必须大于0
- **安全转账**：使用 `call` 方法替代已弃用的 `transfer`
- **零地址检查**：防止转移所有权到零地址

### 数据存储
- **mapping**：`donations` 记录每个地址的捐赠金额
- **数组**：`donors` 存储所有捐赠者地址
- **状态变量**：`totalDonations` 记录总捐赠金额

### 事件日志
- `DonationReceived` - 记录每次捐赠
- `FundsWithdrawn` - 记录每次提取

## 技术规范

- **Solidity版本**：^0.8.19
- **许可证**：MIT
- **网络兼容**：以太坊主网、测试网（Goerli、Sepolia等）
- **Gas优化**：使用高效的存储结构和函数设计

## 部署要求

### 环境准备
1. **Remix IDE**：https://remix.ethereum.org/
2. **MetaMask钱包**：浏览器插件
3. **测试网ETH**：从水龙头获取测试币

### 推荐测试网
- **Sepolia测试网**（推荐）
- **Goerli测试网**

## 使用场景

1. **慈善捐赠**：透明的慈善资金收集
2. **众筹项目**：去中心化的资金筹集
3. **小费系统**：内容创作者的打赏平台
4. **学习实践**：Solidity开发学习项目

## 注意事项

### 安全提醒
- 合约所有者拥有提取所有资金的权限
- 部署前请仔细测试所有功能
- 在主网部署前建议进行安全审计

### Gas费用
- `donate()` 函数：约30,000-50,000 gas
- `withdraw()` 函数：约30,000 gas
- 查询函数：很少的gas费用

### 限制说明
- `getAllDonors()` 函数在捐赠者很多时可能消耗大量gas
- 建议在捐赠者较少时使用，或使用分页查询

## 扩展功能建议

1. **捐赠目标**：设置筹款目标金额
2. **时间限制**：设置捐赠截止时间
3. **退款机制**：未达到目标时的退款功能
4. **多签名**：多个所有者共同管理资金
5. **代币支持**：支持ERC20代币捐赠

## 学习要点

通过这个合约，您可以学习到：
- Solidity基本语法和结构
- `payable` 修饰符的使用
- `mapping` 和数组的数据存储
- 事件（Events）的定义和触发
- 修饰符（Modifiers）的权限控制
- 安全的以太币转账方法
- 合约的部署和测试流程

这是一个非常适合Solidity初学者的实践项目，涵盖了智能合约开发的核心概念。
