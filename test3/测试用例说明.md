# BeggingContract 功能测试用例说明

## 测试环境要求

- **测试网络**：Sepolia 或 Goerli 测试网
- **工具**：Remix IDE + MetaMask
- **测试ETH**：至少 0.1 ETH 测试币
- **测试账户**：至少2个不同的钱包地址

## 详细测试用例

### 测试用例1：合约部署测试

**目标**：验证合约能够成功部署到测试网

**步骤**：
1. 在Remix中编译合约
2. 连接MetaMask到测试网
3. 部署合约
4. 记录合约地址

**预期结果**：
- 编译无错误
- 部署交易成功确认
- 获得有效的合约地址
- 合约所有者为部署者地址

**验证方法**：
```solidity
// 调用以下函数验证
owner() // 应该返回部署者地址
getContractBalance() // 应该返回0
getDonorCount() // 应该返回0
```

---

### 测试用例2：捐赠功能测试

**目标**：验证donate函数能够正确接收和记录捐赠

#### 子测试2.1：正常捐赠
**步骤**：
1. 在Value输入框输入 0.01 ETH
2. 调用donate()函数
3. 确认交易

**预期结果**：
- 交易成功执行
- 合约余额增加0.01 ETH
- 捐赠者记录被正确保存
- 触发DonationReceived事件

**验证方法**：
```solidity
getContractBalance() // 应该返回0.01 ETH (以wei计算)
getDonation(捐赠者地址) // 应该返回0.01 ETH
getDonorCount() // 应该返回1
```

#### 子测试2.2：多次捐赠累计
**步骤**：
1. 同一地址再次捐赠0.02 ETH
2. 确认交易

**预期结果**：
- 该地址总捐赠金额为0.03 ETH
- 合约总余额为0.03 ETH
- 捐赠者数量仍为1

**验证方法**：
```solidity
getDonation(捐赠者地址) // 应该返回0.03 ETH
getContractBalance() // 应该返回0.03 ETH
getDonorCount() // 应该仍为1
```

#### 子测试2.3：零金额捐赠（负面测试）
**步骤**：
1. Value设置为0
2. 调用donate()函数

**预期结果**：
- 交易应该失败
- 显示错误信息："Donation amount must be greater than 0"

---

### 测试用例3：直接转账测试

**目标**：验证receive()和fallback()函数能正确处理直接转账

**步骤**：
1. 在MetaMask中直接向合约地址转账0.005 ETH
2. 确认交易

**预期结果**：
- 交易成功
- 自动调用donate()函数
- 转账金额被正确记录

**验证方法**：
```solidity
getDonation(转账地址) // 应该包含0.005 ETH
getContractBalance() // 应该增加0.005 ETH
```

---

### 测试用例4：查询功能测试

**目标**：验证所有查询函数返回正确数据

#### 子测试4.1：单个捐赠查询
**步骤**：
1. 调用getDonation(已捐赠地址)
2. 调用getDonation(未捐赠地址)

**预期结果**：
- 已捐赠地址返回正确金额
- 未捐赠地址返回0

#### 子测试4.2：捐赠者列表查询
**步骤**：
1. 使用不同地址进行多次捐赠
2. 调用getAllDonors()
3. 调用getDonorByIndex(0), getDonorByIndex(1)等

**预期结果**：
- getAllDonors()返回所有捐赠者地址
- getDonorByIndex()返回正确的地址
- 索引超出范围时应该报错

#### 子测试4.3：统计信息查询
**步骤**：
1. 调用getDonorCount()
2. 调用getContractBalance()
3. 查看totalDonations变量

**预期结果**：
- 所有数据保持一致
- 数值正确反映当前状态

---

### 测试用例5：权限控制测试

**目标**：验证onlyOwner修饰符正确工作

#### 子测试5.1：所有者提取资金
**步骤**：
1. 使用部署者账户调用withdraw()
2. 记录提取前后的余额

**预期结果**：
- 交易成功执行
- 合约余额变为0
- 所有者账户余额增加
- 触发FundsWithdrawn事件

#### 子测试5.2：非所有者提取资金（负面测试）
**步骤**：
1. 切换到非所有者账户
2. 尝试调用withdraw()

**预期结果**：
- 交易失败
- 显示错误信息："Only the contract owner can perform this action"
- 合约余额不变

---

### 测试用例6：紧急功能测试

**目标**：验证紧急提取和所有权转移功能

#### 子测试6.1：紧急提取
**步骤**：
1. 合约有余额的情况下
2. 所有者调用emergencyWithdraw()

**预期结果**：
- 功能与withdraw()相同
- 资金成功提取

#### 子测试6.2：所有权转移
**步骤**：
1. 准备新的所有者地址
2. 调用transferOwnership(新地址)
3. 验证所有权变更

**预期结果**：
- owner变量更新为新地址
- 原所有者无法再调用onlyOwner函数
- 新所有者可以正常使用权限函数

---

### 测试用例7：边界条件测试

#### 子测试7.1：大额捐赠
**步骤**：
1. 捐赠较大金额（如1 ETH）
2. 验证所有功能正常

#### 子测试7.2：多捐赠者场景
**步骤**：
1. 使用10个不同地址进行捐赠
2. 验证getAllDonors()函数性能
3. 测试各种查询功能

#### 子测试7.3：重复操作
**步骤**：
1. 同一地址多次小额捐赠
2. 验证累计计算正确性

---

## 测试数据记录表

| 测试用例 | 执行时间 | 结果 | Gas消耗 | 备注 |
|---------|---------|------|---------|------|
| 合约部署 | | ✅/❌ | | |
| 首次捐赠 | | ✅/❌ | | |
| 重复捐赠 | | ✅/❌ | | |
| 直接转账 | | ✅/❌ | | |
| 查询功能 | | ✅/❌ | | |
| 资金提取 | | ✅/❌ | | |
| 权限控制 | | ✅/❌ | | |

## 性能基准

### Gas消耗参考
- **部署合约**：~1,200,000 gas
- **首次捐赠**：~50,000 gas
- **重复捐赠**：~35,000 gas
- **提取资金**：~30,000 gas
- **查询函数**：~500-2,000 gas

### 交易确认时间
- **Sepolia**：通常15-30秒
- **Goerli**：通常15-45秒

## 测试报告模板

```
BeggingContract 测试报告

测试环境：
- 网络：[Sepolia/Goerli]
- 合约地址：0x...
- 测试时间：[日期时间]

测试结果总结：
- 总测试用例：[数量]
- 通过：[数量]
- 失败：[数量]
- 成功率：[百分比]

主要发现：
- [记录重要发现]
- [性能表现]
- [安全性评估]

建议改进：
- [如有需要]
```

## 常见问题排查

### 1. 交易失败
- 检查Gas Limit设置
- 确认网络连接稳定
- 验证账户余额充足

### 2. 函数调用无响应
- 刷新Remix页面
- 重新连接MetaMask
- 检查合约地址正确性

### 3. 数据不一致
- 等待区块确认
- 检查是否在正确网络
- 验证合约状态

完成所有测试用例后，您将对BeggingContract的功能有全面的了解，并能确保合约在实际使用中的可靠性。
